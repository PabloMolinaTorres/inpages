$('#buscar').click(function () {
    $('#imgContainer').empty();
    $('#errorLog').empty(); // Limpiamos el log de errores
    skuList = [];
    var skus = $('#skuInputLeft').val().trim().split('\n');
    var foundSKUs = []; // Array para almacenar SKUs encontradas
    var notFoundSKUs = []; // Array para almacenar SKUs no encontradas (errores)

    if (skus.length > 0) {
        skus.forEach(function (sku) {
            sku = sku.trim();
            if (sku) {
                if (mode === "vista") {
                    skuList.push(sku);
                    loadImage(sku).then(function (imageElement) {
                        if (imageElement) {
                            foundSKUs.push(sku); // Añadir SKU encontrada
                            document.getElementById('imgContainer').appendChild(imageElement);
                        } else {
                            notFoundSKUs.push(sku); // Añadir SKU no encontrada
                            $('#errorLog').append('<p>No se encontró la vista: ' + sku + '</p>'); // Log de errores
                        }
                        updateCounts();
                    });
                } else if (mode === "sku") {
                    var suffixes = getSuffixes(activeLogic);
                    var found = false;
                    suffixes.forEach(function (suffix, index) {
                        loadImage(sku, suffix).then(function (imageElement) {
                            if (imageElement) {
                                found = true;
                                if (!foundSKUs.includes(sku)) {
                                    foundSKUs.push(sku); // Añadir SKU encontrada
                                }
                                document.getElementById('imgContainer').appendChild(imageElement);
                            }
                            if (!found && index === suffixes.length - 1) {
                                notFoundSKUs.push(sku); // Añadir SKU no encontrada después de revisar todos los sufijos
                                $('#errorLog').append('<p>No se encontraron imágenes para SKU: ' + sku + '</p>'); // Log de errores
                            }
                            updateCounts();
                        });
                    });
                }
            }
        });

        // Al final, eliminamos las SKUs no encontradas del cuadro de texto izquierdo
        setTimeout(function () {
            var remainingSKUs = skus.filter(sku => !notFoundSKUs.includes(sku)).join('\n');
            $('#skuInputLeft').val(remainingSKUs); // Actualizamos la caja de búsqueda
        }, 1000); // Retrasamos para asegurarnos de que la búsqueda termine
    } else {
        alert('Por favor, ingrese SKUs.');
    }
});
